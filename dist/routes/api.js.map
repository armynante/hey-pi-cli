{"version":3,"sources":["../../src/routes/api.js"],"names":[],"mappings":"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","file":"api.js","sourcesContent":["import express from 'express';\nimport Mongo from '../server.js';\nimport bodyParser from 'body-parser';\nimport { ObjectID } from \"mongodb\";\nimport guests from './guests.js';\n\nvar router = express.Router();\n\n//assigns the users users or \"guests\" an api key and password.\n//also deals with lost passwords\nrouter.use('/guests',guests);\n\nrouter.get('/collections', (req,res) => {\n\tMongo.collectionNames().then((resp) => {\n\t\tres.status(resp.code).json(resp.message);\n\t})\n\t.catch((err) => {\n\t\tconsole.log(err);\n\t\tres.json(\"error pulling collection names\");\n\t})\n})\n\nrouter.get('/*', (req, res) => {\n\t\tif(req.strip_path[0] !== undefined) {\n\t \t\tMongo._getData(req.strip_path, req.user._id).then((resp) => {\n        req.user.reads++;\n        Mongo._update('users',{'_id':req.user._id}, req.user);\n\t\t\t\tres.status(resp.code).json(resp.message);\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\tres.json(\"error querying path \" + req.strip_path);\n\t\t\t});\n\t\t} else {\n\t\t\tres.status(404).json(\"Hi!\");\n\t\t}\n\t});\n\nrouter.post('/*', (req,res) => {\n\t\tMongo._saveData(req.strip_path, req.body, req.user._id).then((resp) => {\n      req.user.writes++;\n      req.user.numDocs++;\n      Mongo._update('users',{'_id':req.user._id}, req.user);\n\t\t\tres.json(resp.message);\n\t\t})\n\t\t.catch((err) => {\n\t\t\tres.status(err.code).json(\"error saving data\");\n\t\t});\n\t})\n\nrouter.put('/*', (req,res) => {\n\t\tMongo._updateData(req.strip_path, req.body, req.user._id).then((resp) => {\n      req.user.writes++;\n      Mongo._update('users',{'_id':new ObjectID(req.user._id)}, req.user);\n\t\t\tres.status(resp.code).json(resp.message);\n\t\t})\n\t\t.catch((err) => {\n\t\t\tres.status(500).json(err.message);\n\t\t});\n\t})\n\nrouter.delete('/*', (req,res) => {\n\t\tMongo._delData(req.strip_path, req.user._id).then((resp) => {\n      debugger;\n      req.user.writes += resp.docDelta;\n      req.user.numDocs -= resp.docDelta;\n      Mongo._update('users',{'_id':new ObjectID(req.user._id)}, req.user);\n\t\t\tres.status(resp.code).json(resp.message);\n\t\t})\n\t\t.catch((err) => {\n\t\t\tres.status(err.code).json(\"error updating data\");\n\t\t});\n\t});\n\nexport default router\n"]}