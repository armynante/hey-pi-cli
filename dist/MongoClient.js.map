{"version":3,"sources":["../src/MongoClient.js"],"names":[],"mappings":"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","file":"MongoClient.js","sourcesContent":[" \"use strict\";\n\n import utilities from './utilities.js';\n import collectionUtil from './collectionUtil.js';\n import _ from \"underscore\";\n import { MongoClient as Mongo} from \"mongodb\";\n\n export class MongoClient extends Mongo {\n\n \tconstructor() {\n \t\tsuper();\n \t\tthis.db = null;\n \t}\n\n  collectionNames() {\n    var promise = new Promise(\n      (resolve, reject) => {\n        this.db.listCollections().toArray((err, collections) => {\n          if (err) {\n            console.log(err);\n            reject({code: 500, message: err })\n          }\n          resolve({code: 200, message: collections });\n        });\n      }\n    )\n    return promise;\n  }\n\n \t_dbConnect(url) {\n    var _this = this;\n \t\tMongo.connect(url, function(err, db) {\n      if (err) throw err;\n      db.collection('users').ensureIndex( { \"email\": 1 }, { unique: true } );\n      _this.db = db\n \t\t});\n \t}\n\n  _loadCollection(name) {\n \t\tvar promise = new Promise(\n \t\t\t(resolve, reject) => {\n \t\t\t\tthis.db.collection(name, (err, collection) => {\n \t\t\t\t\tif (err)\n \t\t\t\t\t\treject(err);\n \t\t\t\t\telse\n \t\t\t\t\t\tresolve(collection);\n \t\t\t\t});\n \t\t\t}\n \t\t);\n \t\treturn promise;\n \t}\n\n  _save(name,obj) {\n    var promise = new Promise(\n      (resolve, reject) => {\n        this.db.collection(name).insertOne(obj, (err,resp) => {\n          //check for duplicate entry\n          if (err !== null ) {\n            reject({code: 400, message: \"looks like that email is already taken\" })\n          } else {\n            resolve(resp.ops[0]);\n          }\n        });\n      }\n    );\n    return promise;\n  }\n\n  _get(collectionName,query) {\n    var promise = new Promise(\n      (resolve, reject) => {\n        this.db.collection(collectionName).find(query, (err,resp) => {\n          //check for duplicate entry\n          if (err !== null ) {\n            reject({code: 500, message: \"error querying \" + query })\n          } else {\n            resp.toArray( (err, docs)=> {\n              if (err !== null ) {\n                reject(err);\n              } else {\n                resolve(docs);\n              }\n            })\n          }\n        });\n      }\n    );\n    return promise;\n  }\n\n  _delete(collectionName,query) {\n    var promise = new Promise(\n      (resolve, reject) => {\n        this.db.collection(collectionName).remove(query,{justOne:true}, (err,resp) => {\n\n          if (err !== null ) {\n            reject({code: 500, message: \"error deleting \" + query })\n          } else {\n            resolve({code: 200, message: resp.result.n + \" document deleted\" });\n          }\n        });\n      }\n    );\n    return promise;\n  }\n\n\n  //simple update for admin functions\n  _update(name, query, obj) {\n    var promise = new Promise(\n      (resolve, reject) => {\n        this.db.collection(name).updateOne(query, {$set: obj}, (err,resp) => {\n          //check for duplicate entry\n          if (err !== null ) {\n            reject({code: 400, message: err })\n          } else {\n            resolve(resp);\n          }\n        });\n      }\n    );\n    return promise;\n  }\n\n \t_getData(path, id) {\n \t\tvar promise = new Promise((resolve, reject) => {\n\n \t\t\tthis._propagateQuery(path).then((resolveObj) => {\n \t\t\t\tvar collection = resolveObj.collection;\n \t\t\t\tvar mongoQuery = resolveObj.mongoQuery;\n\n        //only load data created by the user\n        mongoQuery['heypi_id'] = id;\n\n \t\t\t\tcollection.find(mongoQuery,{heypi_id:0}).toArray((err, docs) => {\n\n \t\t\t\t\tdocs = (docs);\n\n \t\t\t\t\tif (err) reject({\n \t\t\t\t\t\t\"code\": 500,\n \t\t\t\t\t\t\"message\": err\n \t\t\t\t\t});\n\n \t\t\t\t\tvar responseData = {\n \t\t\t\t\t\t\"code\": 200,\n \t\t\t\t\t\t\"message\": docs\n \t\t\t\t\t};\n \t\t\t\t\tresolve(responseData);\n \t\t\t\t});\n\n \t\t\t}, (err) => {\n \t\t\t\tvar responseData = {\n \t\t\t\t\t\"code\": 500,\n \t\t\t\t\t\"message\": err\n \t\t\t\t};\n \t\t\t\treject(responseData);\n \t\t\t});\n \t\t});\n \t\treturn promise;\n \t}\n\n \t_delData(path, id) {\n\n \t\tvar promise = new Promise((resolve, reject) => {\n\n \t\t\tthis._propagateQuery(path, id).then((resolveObj) => {\n \t\t\t\tvar collection = resolveObj.collection;\n \t\t\t\tvar mongoQuery = resolveObj.mongoQuery;\n        mongoQuery['heypi_id'] = id;\n        console.log(mongoQuery);\n \t\t\t\tcollection.deleteMany(mongoQuery, (err, result) => {\n\n \t\t\t\t\tif (err) reject({\n \t\t\t\t\t\t\"code\": 500,\n \t\t\t\t\t\t\"message\": err\n \t\t\t\t\t});\n\n \t\t\t\t\tvar numDocsDeleted = result.deletedCount;\n \t\t\t\t\tvar responseData = {\n \t\t\t\t\t\t\"code\": 200,\n \t\t\t\t\t\t\"message\": \"Deleteted \" + numDocsDeleted + \" documents.\",\n \t\t\t\t\t\t\"docDelta\": numDocsDeleted\n \t\t\t\t\t};\n \t\t\t\t\tresolve(responseData);\n \t\t\t\t});\n \t\t\t}, (err) => {\n \t\t\t\tvar responseData = {\n \t\t\t\t\t\"code\": 500,\n \t\t\t\t\t\"message\": err\n \t\t\t\t};\n \t\t\t\treject(responseData);\n \t\t\t});\n \t\t});\n \t\treturn promise;\n \t}\n\n \t_propagateQuery(path, id) {\n \t\tvar pathArray = [];\n \t\tif (path.length % 2 === 1) path.push(\"\");\n \t\tvar promise = new Promise(\n \t\t\t(resolve, reject) => {\n \t\t\t\tfor (var i = 0; i < path.length; i += 2) {\n \t\t\t\t\tpathArray.push([path[i], path[i + 1]]);\n \t\t\t\t}\n\n \t\t\t\tvar chain = pathArray.reduce((previous, item, index, array) => {\n\n \t\t\t\t\treturn previous.then((result) => {\n \t\t\t\t\t\tvar collectionName = item[0];\n \t\t\t\t\t\tvar query = item[1];\n\n \t\t\t\t\t\tvar mongoQuery = utilities.parseQuery(query);\n\n\n \t\t\t\t\t\tif (mongoQuery === null) {\n \t\t\t\t\t\t\treject(\"bad request\");\n \t\t\t\t\t\t}\n\n            //push id into query\n            mongoQuery['heypi_id'] = id;\n\n \t\t\t\t\t\tmongoQuery = _.extend(mongoQuery, result.fkQuery);\n\n \t\t\t\t\t\tvar promise = new Promise(\n \t\t\t\t\t\t\t(resolve, reject) => {\n \t\t\t\t\t\t\t\tthis._loadCollection(collectionName)\n \t\t\t\t\t\t\t\t\t.then((collection) => {\n \t\t\t\t\t\t\t\t\t\tif (index !== (pathArray.length - 1)) {\n \t\t\t\t\t\t\t\t\t\t\tvar cursor = collection.find(mongoQuery);\n\n \t\t\t\t\t\t\t\t\t\t\tcursor.toArray((err, docs) => {\n \t\t\t\t\t\t\t\t\t\t\t\tif (err) {\n \t\t\t\t\t\t\t\t\t\t\t\t\treject(err);\n \t\t\t\t\t\t\t\t\t\t\t\t} else {\n \t\t\t\t\t\t\t\t\t\t\t\t\tvar keys = _.pluck(docs, \"_id\");\n\n \t\t\t\t\t\t\t\t\t\t\t\t\tfor (var i = 0; i < keys.length; i++) {\n \t\t\t\t\t\t\t\t\t\t\t\t\t\tkeys[i] = keys[i].toString();\n \t\t\t\t\t\t\t\t\t\t\t\t\t};\n\n \t\t\t\t\t\t\t\t\t\t\t\t\tvar fkFieldName = collectionName + \"id\";\n \t\t\t\t\t\t\t\t\t\t\t\t\tvar fkQuery = {};\n \t\t\t\t\t\t\t\t\t\t\t\t\tfkQuery[fkFieldName] = {\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t$in: keys\n \t\t\t\t\t\t\t\t\t\t\t\t\t};\n \t\t\t\t\t\t\t\t\t\t\t\t\tresolve({\n \t\t\t\t\t\t\t\t\t\t\t\t\t\tdoc: docs,\n \t\t\t\t\t\t\t\t\t\t\t\t\t\tfkQuery: fkQuery\n \t\t\t\t\t\t\t\t\t\t\t\t\t});\n\n \t\t\t\t\t\t\t\t\t\t\t\t}\n \t\t\t\t\t\t\t\t\t\t\t})\n \t\t\t\t\t\t\t\t\t\t} else {\n \t\t\t\t\t\t\t\t\t\t\tvar resolveObj = {};\n \t\t\t\t\t\t\t\t\t\t\tresolveObj[\"collection\"] = collection;\n \t\t\t\t\t\t\t\t\t\t\tresolveObj[\"mongoQuery\"] = mongoQuery;\n \t\t\t\t\t\t\t\t\t\t\tresolve(resolveObj);\n \t\t\t\t\t\t\t\t\t\t}\n \t\t\t\t\t\t\t\t\t});\n \t\t\t\t\t\t\t});\n \t\t\t\t\t\treturn promise;\n \t\t\t\t\t});\n \t\t\t\t}, new Promise(\n \t\t\t\t\t(resolve, reject) => { //initial value given to reduce\n \t\t\t\t\t\tvar result = {};\n \t\t\t\t\t\tresult[\"fkQuery\"] = {};\n \t\t\t\t\t\tresolve(result);\n \t\t\t\t\t}));\n\n \t\t\t\tchain.then((cursor) => {\n \t\t\t\t\t//var responseData = {\"code\": 200, \"body\": result.doc};\n \t\t\t\t\tresolve(cursor);\n \t\t\t\t}, (err) => {\n \t\t\t\t\tconsole.log('got into error clause after chain is finished' + err);\n \t\t\t\t\t//var responseData = {\"code\": 500, \"body\": err};\n \t\t\t\t\treject(err);\n \t\t\t\t});\n \t\t\t});\n \t\treturn promise;\n \t}\n\n \t_updateData(path, data, id) {\n\n \t\tvar collectionName = path[0];\n\n \t\tvar promise = new Promise(\n \t\t\t(resolve, reject) => {\n\n \t\t\t\tthis._loadCollection(collectionName)\n\n \t\t\t\t.then((collection) => {\n \t\t\t\t\treturn updateDataHelper(collection, id);\n \t\t\t\t})\n\n \t\t\t\t.then((response) => {\n\n \t\t\t\t\tvar modifiedCount = response.result.modifiedCount;\n\n \t\t\t\t\tif (modifiedCount > 0) {\n\n \t\t\t\t\t\tvar responseData = {\n \t\t\t\t\t\t\t\"code\": 200,\n \t\t\t\t\t\t\t\"message\": \"Updated \" +\n \t\t\t\t\t\t\t\tmodifiedCount +\n \t\t\t\t\t\t\t\t\" documents\"\n \t\t\t\t\t\t};\n \t\t\t\t\t} else {\n\n \t\t\t\t\t\tvar responseData = {\n \t\t\t\t\t\t\t\"code\": 204,\n \t\t\t\t\t\t\t\"message\": \"No documents updated :(\"\n \t\t\t\t\t\t};\n \t\t\t\t\t}\n \t\t\t\t\tresolve(responseData);\n \t\t\t\t})\n        .catch((err) => {\n          reject(err);\n        });\n \t\t\t}\n \t\t);\n\n \t\treturn promise;\n\n\n \t\tfunction updateDataHelper(collection, id) {\n \t\t\t// remove id field from obj\n\n  \t\tvar promise = new Promise(\n  \t\t    (resolve, reject) => {\n\n          delete data[\"id\"];\n\n     \t\t\tif (path.length > 1) {\n     \t\t\t\tvar mongoQuery = utilities.parseQuery(path[1]);\n            mongoQuery['heypi_id'] = id;\n     \t\t\t}\n\n     \t\t\tif (path.length == 2) {\n  \t\t\t\t\tcollectionUtil.updateOne(collection, mongoQuery, data)\n  \t\t\t\t\t\t.then((result) => {\n\n  \t\t\t\t\t\t\tresolve(result)\n  \t\t\t\t\t\t}, (err) => {\n  \t\t\t\t\t\t\treject(err);\n  \t\t\t\t\t\t})\n     \t\t\t} else {\n            var responseData = {\n              \"code\": 400,\n              \"message\": \"Cannot PUT data on collections.\"\n            };\n            reject(responseData)\n          }\n \t\t    }\n      );\n \t\t return promise;\n    }\n \t}\n\n \t_saveData(path, data, id) {\n    var _this = this;\n \t\tvar collectionName = path[0];\n\n \t\tvar promise = new Promise(\n \t\t\t(resolve, reject) => {\n \t\t\t_this._loadCollection(collectionName)\n      .then((collection) => {\n \t\t\t\t\treturn saveDataHelper(collection, id);\n \t\t\t})\n\n \t\t\t.then((docs) => {\n \t\t\t\t\tdocs = utilities.sanitizeId(docs);\n \t\t\t\t\tvar responseData = {\n \t\t\t\t\t\t\"code\": 201,\n \t\t\t\t\t\t\"message\": docs\n \t\t\t\t\t};\n \t\t\t\t\tresolve(responseData);\n\n \t\t\t\t}, (err) => {\n\n \t\t\t\t\tvar responseData = {\n \t\t\t\t\t\t\"code\": 500,\n \t\t\t\t\t\t\"message\": err.message\n \t\t\t\t\t};\n \t\t\t\t\tconsole.log(\"response data is: \" + responseData)\n \t\t\t\t\tresolve(responseData);\n \t\t\t\t});\n \t\t\t}\n \t\t);\n\n \t\treturn promise;\n\n\n \t\tfunction saveDataHelper(collection, id) {\n      console.log(data);\n      data['heypi_id'] = id;\n\n \t\t\tif (path.length > 1) {\n \t\t\t\tvar mongoQuery = utilities.parseQuery(path[1]);\n        if (mongoQuery !== null) {\n          mongoQuery['heypi_id'] = id;\n        }\n \t\t\t}\n\n \t\t\tif (path.length === 1) {\n \t\t\t\tvar promise = new Promise(\n \t\t\t\t\t(resolve, reject) => {\n \t\t\t\t\t\tcollection.insertOne(\n              data,\n              function(err, result) {\n \t\t\t\t\t\t\tif (err) {\n \t\t\t\t\t\t\t\treject(err);\n \t\t\t\t\t\t\t} else {\n                var data = result.ops[0]\n                delete data['heypi_id'];\n \t\t\t\t\t\t\t\tresolve(result.ops[0]);\n \t\t\t\t\t\t\t}\n \t\t\t\t\t\t});\n \t\t\t\t\t}\n \t\t\t\t);\n\n \t\t\t\treturn promise;\n\n \t\t\t} else if (path.length == 2) {\n \t\t\t\t//TODO: need to take this out into its own function!!!\n\n \t\t\t\tvar promise = new Promise(\n \t\t\t\t\t(resolve, reject) => {\n \t\t\t\t\t\tcollectionUtil.updateOne(collection, mongoQuery, data)\n \t\t\t\t\t\t\t.then((result) => {\n \t\t\t\t\t\t\t\tresolve(result)\n\n \t\t\t\t\t\t\t}, (err) => {\n \t\t\t\t\t\t\t\treject(err);\n \t\t\t\t\t\t\t})\n \t\t\t\t\t}\n \t\t\t\t);\n\n \t\t\t\treturn promise;\n\n \t\t\t} else if (path.length === 3) {\n \t\t\t\tvar collectionToAddTo = path[2];\n \t\t\t\tvar parentID;\n\n \t\t\t\tvar promise = new Promise(\n \t\t\t\t\t(resolve, reject) => {\n \t\t\t\t\t\tcollectionUtil.findOne(collection, mongoQuery)\n\n \t\t\t\t\t\t.then((doc) => {\n \t\t\t\t\t\t\tparentID = doc._id.toString();\n \t\t\t\t\t\t\treturn _this._loadCollection(collectionToAddTo);\n \t\t\t\t\t\t})\n\n \t\t\t\t\t\t.then((collectionToAddToObj) => {\n \t\t\t\t\t\t\tvar obj = {};\n \t\t\t\t\t\t\tvar keyName = collectionName + \"id\";\n \t\t\t\t\t\t\tobj[keyName] = parentID;\n \t\t\t\t\t\t\tdata = _.extend(data, obj);\n \t\t\t\t\t\t\treturn collectionUtil.insertOne(collectionToAddToObj, data);\n \t\t\t\t\t\t})\n\n \t\t\t\t\t\t.then((result) => {\n \t\t\t\t\t\t\tresolve(result.ops[0]);\n \t\t\t\t\t\t}, (err) => {\n \t\t\t\t\t\t\treject(err);\n \t\t\t\t\t\t});\n \t\t\t\t\t}\n \t\t\t\t);\n \t\t\t\treturn promise;\n \t\t\t}\n \t\t}\n \t}\n}\n"]}